{% assign lang = page.lang | default: 'ja' -%}
{%- if lang == 'ja'  %}
{% assign placeholder = "„Åì„Åì„Å´„Çø„Ç§„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ...&#13;&#10;‰æã:" %}
{%- assign btn-copy = '„Ç≥„Éî„Éº' -%}
{%- assign btn-copied = '„Ç≥„Éî„ÉºÂÆå‰∫Ü' -%}
{%- assign copy-error = '„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü' -%}
{%- assign box-left = 'X-ÊñπÂºè' -%}
{%- assign box-right = 'Â≠ó‰∏äÁ¨¶‰ªò„ÅçÊñáÂ≠ó' -%}
{%- assign misskey-lang = 'ja' -%}
{%- endif -%}
{%- if lang == 'eo' -%}
{%- assign placeholder = "Tajpu ƒâi tie...&#13;&#10;ekz.," -%}
{%- assign btn-copy = 'kopii' -%}
{%- assign btn-copied = 'Kopiita' -%}
{%- assign copy-error = 'Kopio malsukcesis' -%}
{%- assign box-left = 'X-sistemo' -%}
{%- assign box-right = 'ƒàapelitaj literoj' -%}
{%- assign misskey-lang = 'en' -%}
{%- endif %}
<div class="container">
  <div class="box-wrapper">
    <div class="textbox-header">{{ box-left }}</div>
    <textarea id="input-ascii" placeholder="{{ placeholder }} cx, gx, ux, les eauxx"></textarea>
  </div>

  <div class="box-wrapper">
    <div class="textbox-header">{{ box-right }}</div>
    <textarea id="output-esperanto" readonly></textarea>
    
    <div class="btn-controls">
        <button id="btn-copy" class="btn-copy" onclick="copyText()">üìã {{ btn-copy }}</button>
        <button class="btn-x" title="X (Twitter)" onclick="postText('twitter')">
          <svg class="svg-icon"><use xlink:href="{{ '/assets/social-icons.svg#twitter' | relative_url }}" fill="#fff"></use></svg>
        </button>
        <button class="btn-bsky" title="Bluesky" onclick="postText('bsky')">
          <svg class="svg-icon"><use xlink:href="{{ '/assets/social-icons.svg#bluesky' | relative_url }}" fill="#fff"></use></svg>
        </button>
        <button class="btn-misskey" title="Misskey" onclick="postText('misskey')">
          <svg class="svg-icon"><use xlink:href="{{ '/assets/social-icons.svg#misskey' | relative_url }}" fill="#fff"></use></svg>
        </button>
        <button class="btn-mastodon" title="Mastodon" onclick="postText('mastodon')">
          <svg class="svg-icon"><use xlink:href="{{ '/assets/social-icons.svg#mastodon' | relative_url }}" fill="#fff"></use></svg>
        </button>
    </div>
  </div>
</div>

<script>
  const inputBox = document.getElementById('input-ascii');
  const outputBox = document.getElementById('output-esperanto');
  const copyButton = document.getElementById('btn-copy');

  // Â§âÊèõ„Éû„ÉÉ„Éó„ÅÆÂÆöÁæ©
  const char_set = [
    ["cx", "ƒâ"],
    ["Cx", "ƒà"],
    ["gx", "ƒù"],
    ["Gx", "ƒú"],
    ["hx", "ƒ•"],
    ["Hx", "ƒ§"],
    ["jx", "ƒµ"],
    ["Jx", "ƒ¥"],
    ["sx", "≈ù"],
    ["Sx", "≈ú"],
    ["ux", "≈≠"],
    ["Ux", "≈¨"],
    ["xx", "x"] //Â§öË®ÄË™û„ÉÜ„Ç≠„Çπ„Éà„Å´„Åä„ÅÑ„Å¶ aux -> a≈≠ „Å®„Å™„Çã„ÅÆ„ÇíÈò≤„Åê„Åü„ÇÅ auxx -> aux „Å®Â§âÊèõ
  ];

  // ÊñáÂ≠óÂ§âÊèõÈñ¢Êï∞
  function convertToEsperanto(text) {
    let result = text;
    const tempPlaceholder = "\uFFFF"; // ÂÜÖÈÉ®Âá¶ÁêÜÁî®
    const escapeRow = char_set.find(row => row[0] === "xx");
    if (escapeRow) {
      result = result.replaceAll(escapeRow[0], tempPlaceholder);
    }
    for (let i = 0; i < char_set.length; i++) {
      const row = char_set[i];
      const xStr = row[0];
      const dest = row[1];
      if (xStr === "xx") continue;
      if (xStr) {
        result = result.replaceAll(xStr, dest);
      }
    }
    if (escapeRow) {
      result = result.replaceAll(tempPlaceholder, escapeRow[1]);
    }
    return result;
  }

  // ÂÖ•Âäõ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
  inputBox.addEventListener('input', (e) => {
    const inputText = e.target.value;
    const convertedText = convertToEsperanto(inputText);
    outputBox.value = convertedText;
  });

  // „Ç≥„Éî„ÉºÊ©üËÉΩ
  function copyText() {
    const textToCopy = outputBox.value;
    if (!textToCopy) return;

    navigator.clipboard.writeText(textToCopy).then(() => {
    copyButton.textContent = '{{ btn-copied }}';
      // ÈÄ£Á∂ö„ÇØ„É™„ÉÉ„ÇØ„ÇíÈò≤Ê≠¢
      copyButton.disabled = true;
      // 2ÁßíÂæå„Å´ÂÖÉ„ÅÆÁä∂ÊÖã„Å´
      setTimeout(() => {
          copyButton.textContent = 'üìã {{ btn-copy }}';
          copyButton.disabled = false;
      }, 2000);
    }).catch(err => {
      console.error('{{ copy-error }}:', err);
      alert('{{ copy-error }}');
    });
  }

  // „Ç∑„Çß„Ç¢Ê©üËÉΩ
  function postText(platform) {
    const textToShare = outputBox.value;
    if (!textToShare) return;
    const encodedText = encodeURIComponent(textToShare);
    let postURL;
    if (platform == "twitter") {
      postURL = `https://twitter.com/intent/tweet?text=${encodedText}`;
    }
    else if (platform == "bsky") {
      postURL = `https://bsky.app/intent/compose?text=${encodedText}`;
      // postURL = `bluesky://intent/compose?text=${encodedText}`;
    }
    else if (platform == "misskey") {
      postURL = `https://misskey-hub.net/{{ misskey-lang }}/share/?text=${encodedText}&visibility=public&localOnly=0&manualInstance=misskey.io`;
    }
    else if (platform == "mastodon") {
      postURL = `https://mastodonshare.com/?text=${encodedText}`;
    }
    window.open(postURL, '_blank');
  }
</script>