{% assign lang = page.lang | default: 'ja' -%}
{%- if lang == 'ja'  %}
{% assign placeholder = "ã“ã“ã«ã‚¿ã‚¤ãƒ—ã—ã¦ãã ã•ã„...&#13;&#10;ä¾‹:" %}
{%- assign btn-copy = 'ã‚³ãƒ”ãƒ¼' -%}
{%- assign btn-copied = 'ã‚³ãƒ”ãƒ¼å®Œäº†' -%}
{%- assign copy-error = 'ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ' -%}
{%- assign box-left = 'X-æ–¹å¼' -%}
{%- assign box-right = 'å­—ä¸Šç¬¦ä»˜ãæ–‡å­—' -%}
{%- assign share = 'ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ•ç¨¿' -%}
{%- endif -%}
{%- if lang == 'eo' -%}
{%- assign placeholder = "Tajpu Ä‰i tie...&#13;&#10;ekz.," -%}
{%- assign btn-copy = 'kopii' -%}
{%- assign btn-copied = 'Kopiita' -%}
{%- assign copy-error = 'Kopio malsukcesis' -%}
{%- assign box-left = 'X-sistemo' -%}
{%- assign box-right = 'Äˆapelitaj literoj' -%}
{%- assign share = 'AfiÅi Ä‰i tiun tekston Ä‰e:' -%}
{%- endif %}
<div class="container">
  <div class="box-wrapper">
    <div class="textbox-header">{{ box-left }}</div>
    <textarea id="input-ascii" placeholder="{{ placeholder }} cx, gx, ux, les eauxx"></textarea>
  </div>

  <div class="box-wrapper">
    <div class="textbox-header">{{ box-right }}</div>
    <textarea id="output-esperanto" readonly></textarea>
    
    <div class="btn-controls">
        <button id="btn-copy" class="btn-copy" onclick="copyText()">ğŸ“‹ {{ btn-copy }}</button>
        <!--<div>{{ share }}</div>-->
        <button class="btn-x" title="X (Twitter)" onclick="shareToX()">
          <svg class="svg-icon"><use xlink:href="{{ '/assets/social-icons.svg#twitter' | relative_url }}" fill="#fff"></use></svg>
        </button>
        <button class="btn-bsky" title="Bluesky" onclick="shareToBsky()">
          <svg class="svg-icon"><use xlink:href="{{ '/assets/social-icons.svg#bluesky' | relative_url }}" fill="#fff"></use></svg>
        </button>
        <button class="btn-misskey" title="Misskey" onclick="shareToMisskey()">
          <svg class="svg-icon"><use xlink:href="{{ '/assets/social-icons.svg#misskey' | relative_url }}" fill="#fff"></use></svg>
        </button>
        <button class="btn-mastodon" title="Mastodon" onclick="shareToMastodon()">
          <svg class="svg-icon"><use xlink:href="{{ '/assets/social-icons.svg#mastodon' | relative_url }}" fill="#fff"></use></svg>
        </button>
    </div>
  </div>
</div>

<script>
  const inputBox = document.getElementById('input-ascii');
  const outputBox = document.getElementById('output-esperanto');
  const copyButton = document.getElementById('btn-copy');

  // å¤‰æ›ãƒãƒƒãƒ—ã®å®šç¾©
  const char_set = [
    ["cx", "Ä‰"],
    ["Cx", "Äˆ"],
    ["gx", "Ä"],
    ["Gx", "Äœ"],
    ["hx", "Ä¥"],
    ["Hx", "Ä¤"],
    ["jx", "Äµ"],
    ["Jx", "Ä´"],
    ["sx", "Å"],
    ["Sx", "Åœ"],
    ["ux", "Å­"],
    ["Ux", "Å¬"],
    ["xx", "x"] //å¤šè¨€èªãƒ†ã‚­ã‚¹ãƒˆã«ãŠã„ã¦ aux -> aÅ­ ã¨ãªã‚‹ã®ã‚’é˜²ããŸã‚ auxx -> aux ã¨å¤‰æ›
  ];

  // æ–‡å­—å¤‰æ›é–¢æ•°
  function convertToEsperanto(text) {
    let result = text;
    const tempPlaceholder = "\uFFFF"; // å†…éƒ¨å‡¦ç†ç”¨
    const escapeRow = char_set.find(row => row[0] === "xx");
    if (escapeRow) {
      result = result.replaceAll(escapeRow[0], tempPlaceholder);
    }
    for (let i = 0; i < char_set.length; i++) {
      const row = char_set[i];
      const xStr = row[0];
      const dest = row[1];
      if (xStr === "xx") continue;
      if (xStr) {
        result = result.replaceAll(xStr, dest);
      }
    }
    if (escapeRow) {
      result = result.replaceAll(tempPlaceholder, escapeRow[1]);
    }
    return result;
  }

  // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  inputBox.addEventListener('input', (e) => {
    const inputText = e.target.value;
    const convertedText = convertToEsperanto(inputText);
    outputBox.value = convertedText;
  });

  // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
  function copyText() {
    const textToCopy = outputBox.value;
    if (!textToCopy) return;

    navigator.clipboard.writeText(textToCopy).then(() => {
    copyButton.textContent = '{{ btn-copied }}';
      // é€£ç¶šã‚¯ãƒªãƒƒã‚¯ã‚’é˜²æ­¢
      copyButton.disabled = true;
      // 2ç§’å¾Œã«å…ƒã®çŠ¶æ…‹ã«
      setTimeout(() => {
          copyButton.textContent = 'ğŸ“‹ {{ btn-copy }}';
          copyButton.disabled = false;
      }, 2000);
    }).catch(err => {
      console.error('{{ copy-error }}:', err);
      alert('{{ copy-error }}');
    });
  }

  // ã‚·ã‚§ã‚¢æ©Ÿèƒ½ (X / Twitter)
  function shareToX() {
    const textToShare = outputBox.value;
    if (!textToShare) {
      return;
    }
    // URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦ãƒ„ã‚¤ãƒ¼ãƒˆç”»é¢ã‚’é–‹ã
    const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(textToShare)}`;
    window.open(tweetUrl, '_blank');
  }
  function shareToBsky() {
    const textToShare = outputBox.value;
    if (!textToShare) {
      return;
    }
    const postURL = `https://bsky.app/intent/compose?text=${encodeURIComponent(textToShare)}`;
    window.open(postURL, '_blank');
  }
  function shareToMisskey() {
    const textToShare = outputBox.value;
    if (!textToShare) {
      return;
    }
    const postURL = `https://misskey-hub.net/share/?text=${encodeURIComponent(textToShare)}&visibility=public&localOnly=0&manualInstance=misskey.io`;
    window.open(postURL, '_blank');
  }
  function shareToMastodon() {
    const textToShare = outputBox.value;
    if (!textToShare) {
      return;
    }
    const postURL = `https://mastodonshare.com/?text=${encodeURIComponent(textToShare)}`;
    window.open(postURL, '_blank');
  }
</script>